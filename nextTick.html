<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
	</body>
</html>
<script>
	const callBacks = [];
	let pending = false;
	let timerFunc;
	if(typeof Promise !== 'undefined'){
		const p = Promise.resolve()
		timerFunc = ()=>{
			p.then(flushCallbacks)
		}
	}else{
		timerFunc = ()=>{
			setTimeout(flushCallbacks,0)
		}
	}
	function flushCallbacks() {
		const copies = callBacks.slice(0)
		callBacks.length = 0
		for (let i = 0; i < copies.length; i++) {
			copies[i]()
		}
	}

	function nextTick(cb) {
		let _resolve;
		callBacks.push(() => {
			if (cb) {
				cb("常规")
			} else if (_resolve) {
				_resolve("promise")
			}
		})
		if (!pending) {
			pending = true
			timerFunc()
		}
		if (!cb) {
			return new Promise(resolve => {
				_resolve = resolve
			})
		}
	}
	nextTick(function(res) {
		console.log(res,1)
	})
	nextTick().then(res=>{
		console.log(res,12)
	})
</script>
